<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="admin-container">
    <aside class="sidebar">
      <h2>Admin Panel</h2>
      <ul>
        <li onclick="loadSection('students')">View Students</li>
        <li onclick="loadSection('rooms')">Manage Rooms</li>
        <li onclick="loadSection('bookings')">Manage Bookings</li>
        <li onclick="loadSection('complaints')">Handle Complaints</li>
        <li><a href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </aside>

    <main class="main-content" id="mainContent">
      <h2>Welcome, Admin</h2>
      <p>Select an option from the sidebar to manage the hostel.</p>
    </main>
  </div>

  <script>
    function loadSection(section) {
      const content = document.getElementById('mainContent');
      content.innerHTML = '<div class="spinner"></div><p>Loading...</p>';

      let url;
      if (section === 'students') url = '/view_students';
      else if (section === 'rooms') url = '/manage_rooms';
      else if (section === 'bookings') url = '/view_bookings';
      else if (section === 'complaints') url = '/handle_complaints';

      fetch(url)
        .then(response => {
          if (!response.ok) {
            if (response.status === 401 || response.status === 403) {
              content.innerHTML = '<p class="error">Session expired. Please <a href="/">log in again</a>.</p>';
            } else {
              throw new Error('Network response was not ok');
            }
          }
          return response.text();
        })
        .then(html => {
          content.innerHTML = html;
        })
        .catch(error => {
          content.innerHTML = '<p class="error">Error loading section: ' + error.message + '</p>';
          console.error('Fetch error:', error);
        });
    }

    // Ensure event listeners are properly set up
    document.addEventListener('DOMContentLoaded', () => {
      const sidebarItems = document.querySelectorAll('.sidebar li');
      sidebarItems.forEach(item => {
        // Only add listener if the item doesn't have a direct href (like Logout)
        if (!item.querySelector('a')) {
          item.addEventListener('click', () => {
            const section = item.textContent.toLowerCase().replace(' ', '_');
            loadSection(section);
          });
        }
      });
    });
  </script>
</body>
</html>